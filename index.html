<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">
<title>Student OS</title>
<style>
:root{
  --gap:20px; --radius:14px; --max-width:1200px;
  --bg: #f7f9fb; --surface:#ffffff; --muted:#6b7280; --text:#0b1220;
  --accent:#2563eb; --accent-2:#06b6d4; --glass: rgba(11,18,32,0.05); --shadow: 0 12px 40px rgba(11,18,32,0.1);
  --good: #10b981; --warning: #f59e0b; --danger: #ef4444;
}
.theme-oled{ --bg:#000000; --surface:#040404; --muted:#8b96a8; --text:#e6f0fb; --accent:#60a5fa; --accent-2:#34d399; --glass: rgba(255,255,255,0.04); --shadow: 0 16px 48px rgba(0,0,0,0.6); }
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Roboto,system-ui,-apple-system,"Segoe UI",Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;display:flex;justify-content:center;padding:32px}
.preview{width:100%;max-width:var(--max-width);display:grid;grid-template-columns:280px 1fr;gap:var(--gap)}
.sidebar{background:linear-gradient(180deg,var(--surface),color-mix(in srgb,var(--surface) 94%, transparent));border-radius:var(--radius);padding:20px;border:1px solid var(--glass);box-shadow:var(--shadow);display:flex;flex-direction:column}
.brand{font-weight:800;color:var(--accent);letter-spacing:0.3px;font-size:20px}
.profile{display:flex;gap:14px;align-items:center;margin:16px 0}
.avatar{width:50px;height:50px;border-radius:12px;background:linear-gradient(90deg,var(--accent),var(--accent-2));display:grid;place-items:center;color:var(--surface);font-weight:700;background-size:cover;background-position:center}
.nav{margin:20px 0;display:flex;flex-direction:column;gap:10px}
.nav button{display:flex;align-items:center;gap:12px;padding:10px;border-radius:12px;border:0;background:transparent;color:var(--muted);cursor:pointer;font-size:15px;font-weight:500;transition:background 0.2s, color 0.2s, transform 0.1s}
.nav button:hover{background:linear-gradient(90deg,color-mix(in srgb,var(--accent) 8%, var(--surface)), transparent);color:var(--text);transform:translateX(4px)}
.nav button.active{background:linear-gradient(90deg,color-mix(in srgb,var(--accent) 12%, var(--surface)), transparent);color:var(--text);font-weight:600}
.canvas{display:flex;flex-direction:column;gap:var(--gap)}
.header{display:flex;justify-content:space-between;align-items:center;gap:14px;padding-bottom:12px}
.title{font-size:22px;font-weight:700}
.subtitle{color:var(--muted);font-size:14px;margin-top:4px}
.header-right{display:flex;gap:10px}
.btn{border-radius:12px;padding:10px 16px;border:0;background:var(--accent);color:var(--surface);cursor:pointer;font-size:14px;font-weight:600;transition:background 0.2s, transform 0.1s}
.btn:hover{transform:scale(1.03);background:color-mix(in srgb, var(--accent) 90%, white)}
.btn.ghost{background:transparent;border:1px solid var(--glass);color:var(--text)}
.btn.ghost:hover{background:var(--glass);transform:scale(1.03)}
.grid{display:grid;grid-template-columns:1fr;gap:var(--gap);align-items:start}
.card{background:var(--surface);border-radius:14px;padding:20px;border:1px solid var(--glass);box-shadow:var(--shadow);transition:transform 0.2s, box-shadow 0.2s}
.card:hover{transform:translateY(-4px);box-shadow:0 16px 48px rgba(11,18,32,0.12)}
.card h3{margin:0 0 10px 0;font-size:18px;font-weight:600}
.small{color:var(--muted);font-size:14px}
.tasks{display:flex;flex-direction:column;gap:12px}
.task{display:flex;align-items:center;gap:14px;padding:12px;border-radius:12px;background:linear-gradient(90deg,color-mix(in srgb,var(--surface) 98%, transparent), transparent);border:1px solid color-mix(in srgb,var(--glass) 60%, transparent);transition:background 0.2s, transform 0.2s}
.task:hover{background:linear-gradient(90deg,color-mix(in srgb,var(--accent) 5%, var(--surface)), transparent);transform:translateY(-2px)}
.task .delete-btn { cursor: pointer; color: var(--muted); margin-left: auto; font-size:16px; transition: color 0.2s; }
.task .delete-btn:hover { color: var(--danger); }
.pill{padding:6px 12px;border-radius:999px;font-weight:600;font-size:12px}
.pill.low{background:color-mix(in srgb,var(--surface) 85%, white);color:var(--muted)}
.pill.med{background:#ffd166;color:#042}
.pill.high{background:#ff6b6b;color:#042}
.feature{display:flex;flex-direction:column;gap:10px}
.icon{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#022;font-weight:700}
.notifications{display:flex;flex-direction:column;gap:12px}
.note{display:flex;align-items:flex-start;gap:14px;padding:14px;border-radius:12px;background:linear-gradient(90deg,color-mix(in srgb,var(--surface) 98%, transparent), transparent);border:1px solid color-mix(in srgb,var(--glass) 60%, transparent);white-space:pre-wrap;transition:background 0.2s, transform 0.2s}
.note:hover{background:linear-gradient(90deg,color-mix(in srgb,var(--accent) 5%, var(--surface)), transparent);transform:translateY(-2px)}
.note .delete-btn { cursor: pointer; color: var(--muted); margin-left: auto; font-size:16px; transition: color 0.2s; }
.note .delete-btn:hover { color: var(--danger); }
.footer{display:flex;justify-content:space-between;align-items:center;margin-top:16px;color:var(--muted);font-size:14px}
.hidden { display: none; }
dialog { border: none; border-radius: var(--radius); padding: 24px; background: var(--surface); box-shadow: var(--shadow); max-width: 400px; width: 100%; color: var(--text); }
dialog::backdrop { background: rgba(0,0,0,0.5); }
form { display: flex; flex-direction: column; gap: 14px; }
input, select, textarea { padding: 12px; border-radius: 10px; border: 1px solid var(--glass); background: var(--surface); color: var(--text); font-family: Roboto; font-size: 14px; transition: border-color 0.2s, box-shadow 0.2s; }
input:focus, select:focus, textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 20%, transparent); }
textarea { min-height: 120px; resize: vertical; }
.timer { font-size: 48px; text-align: center; margin: 24px 0; font-family: monospace; }
.links { display: flex; flex-direction: column; gap: 12px; }
.link { display: flex; align-items: center; gap: 14px; padding: 12px; border-radius: 12px; background: linear-gradient(90deg, color-mix(in srgb, var(--surface) 98%, transparent), transparent); border: 1px solid color-mix(in srgb, var(--glass) 60%, transparent); transition: background 0.2s, transform 0.2s; }
.link:hover { background: linear-gradient(90deg, color-mix(in srgb, var(--accent) 5%, var(--surface)), transparent); transform: translateY(-2px); }
.link a { color: var(--accent); text-decoration: none; flex: 1; font-weight: 500; font-size: 15px; }
.link .delete-btn { cursor: pointer; color: var(--muted); font-size: 16px; transition: color 0.2s; }
.link .delete-btn:hover { color: var(--danger); }
.link .link-icon { width: 28px; height: 28px; border-radius: 8px; background: var(--glass); display: flex; align-items: center; justify-content: center; font-size: 16px; }
.calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 18px; }
.cal-header { font-weight: 600; color: var(--muted); text-align: center; padding: 10px; font-size: 14px; }
.cal-day { text-align: center; padding: 12px; border-radius: 10px; cursor: pointer; position: relative; transition: background 0.2s, transform 0.2s; font-size: 14px; }
.cal-day:hover { background: var(--glass); transform: scale(1.05); }
.cal-current { background: var(--accent); color: var(--surface); }
.cal-event-dot { position: absolute; bottom: 6px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; border-radius: 50%; background: var(--accent-2); }
.cal-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
.cal-nav-btn { padding: 8px 16px; border-radius: 10px; border: 1px solid var(--glass); background: transparent; cursor: pointer; font-size: 14px; transition: background 0.2s, transform 0.1s; }
.cal-nav-btn:hover { background: var(--glass); transform: scale(1.03); }
.flashcards { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 18px; }
.flashcard { cursor: pointer; height: 200px; position: relative; }
.flashcard-inner { width: 100%; height: 100%; border-radius: 12px; box-shadow: var(--shadow); position:relative; }
.flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; padding: 24px; text-align: center; background: var(--surface); border: 1px solid var(--glass); border-radius: 12px; font-size: 15px; font-weight: 500; transition: opacity 0.3s; backface-visibility: hidden; }
.flashcard-back { opacity: 0; background: color-mix(in srgb, var(--surface) 95%, var(--accent)); transform: rotateY(180deg); }
.flashcard-front { transform: rotateY(0deg); }
.flashcard.show-back .flashcard-front { opacity: 0; transform: rotateY(-180deg); }
.flashcard.show-back .flashcard-back { opacity: 1; transform: rotateY(0deg); }
.flashcard-category { position: absolute; top: 10px; left: 10px; padding: 5px 10px; border-radius: 8px; background: var(--accent-2); color: var(--surface); font-size: 13px; font-weight: 600; z-index: 2; }
.grades { display: flex; flex-direction: column; gap: 14px; }
.grade { display: flex; flex-direction: column; padding: 16px; border-radius: 12px; background: linear-gradient(90deg, color-mix(in srgb, var(--surface) 98%, transparent), transparent); border: 1px solid color-mix(in srgb, var(--glass) 60%, transparent); transition: background 0.2s, transform 0.2s; }
.grade:hover { background: linear-gradient(90deg, color-mix(in srgb, var(--accent) 5%, var(--surface)), transparent); transform: translateY(-2px); }
.grade-header { display: flex; justify-content: space-between; align-items: center; font-weight: 600; font-size: 16px; }
.grade-list { margin-top: 12px; display: flex; flex-direction: column; gap: 8px; }
.grade-item { display: flex; justify-content: space-between; align-items: center; color: var(--muted); font-size: 14px; }
.grade-item .grade-value { display: flex; align-items: center; gap: 10px; }
.grade-progress { height: 10px; border-radius: 5px; background: var(--glass); overflow: hidden; margin-top: 10px; }
.grade-progress-bar { height: 100%; background: var(--good); transition: width 0.4s ease-in-out; }
.grade .add-grade-btn { margin-top: 12px; font-size: 14px; padding: 8px 16px; }
.grade .delete-btn { cursor: pointer; color: var(--muted); font-size: 16px; transition: color 0.2s; }
.grade .delete-btn:hover { color: var(--danger); }
.settings-form { display: grid; grid-template-columns: 1fr; gap: 20px; }
.settings-form label { display: flex; flex-direction: column; font-size: 14px; font-weight: 500; gap: 6px; }
.settings-form label input, .settings-form label select { margin-top: 0; }
.customize-section { margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--glass); }
.customize-section h4 { margin-bottom: 12px; font-size: 16px; }
.customize-section .toggle { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
.quote { font-style: italic; font-size: 16px; margin-bottom: 8px; }
.quote-author { text-align: right; color: var(--muted); font-size: 14px; }
</style>
</head>
<body>
  <div class="preview" id="preview">
    <aside class="sidebar">
      <div class="brand">StudentOS</div>
      <div class="profile" id="profile">
        <div class="avatar" id="userAvatar"></div>
        <div>
          <div style="font-weight:700;font-size:16px" id="userName">Your Name</div>
          <div class="small" id="userEmail">your@email.com</div>
        </div>
      </div>
      <nav class="nav" aria-label="Main" id="sidebarNav">
        <button class="active" data-view="overview">Overview</button>
        <button data-view="tasks">Tasks</button>
        <button data-view="notes">Notes</button>
        <button data-view="calendar">Calendar</button>
        <button data-view="flashcards">Flashcards</button>
        <button data-view="grades">Grades</button>
        <button data-view="quicklinks">Quick Links</button>
        <button data-view="settings">Settings</button>
      </nav>
      <div style="margin-top:auto" class="small"></div>
    </aside>
    <main class="canvas">
      <div class="header">
        <div>
          <div class="title" id="headerTitle">Student Workspace</div>
          <div class="subtitle">Organize, track, and succeed</div>
        </div>
        <div class="header-right">
          <button id="themeToggle" class="btn ghost">OLED Dark</button>
          <button id="quickAdd" class="btn">+ Quick Add Task</button>
        </div>
      </div>
      <div class="grid" id="overview">
         <div id="overviewTasks" class="card"><h3>Upcoming Tasks</h3><div class="small">Manage your tasks</div><div style="margin-top:16px" class="tasks" id="tasksList"></div></div>
         <div id="overviewNotifications" class="card"><h3>Notifications</h3><div class="small">Reminders & deadlines</div><div style="margin-top:16px" class="notifications" id="notificationsList"></div></div>
         <div id="dailyQuote" class="card"><h3>Daily Motivation</h3><blockquote id="quoteText" class="quote"></blockquote><cite id="quoteAuthor" class="quote-author"></cite></div>
      </div>
      <div class="grid hidden" id="tasks"><div class="card"><h3>All Tasks</h3><div class="small">Manage your tasks here</div><div style="margin-top:16px" class="tasks" id="allTasksList"></div></div></div>
      <div class="grid hidden" id="notes"><div class="card"><h3>Notes</h3><div class="small">Your personal notes</div><div style="margin-top:16px" class="notifications" id="notesList"></div><button id="addNote" class="btn" style="margin-top:16px">+ Add Note</button></div></div>
      <div class="grid hidden" id="calendar"><div class="card"><div class="cal-nav"><button class="cal-nav-btn" id="prevMonthBtn">Previous</button><h3 id="calendarMonth"></h3><button class="cal-nav-btn" id="nextMonthBtn">Next</button></div><div class="calendar" id="calendarGrid"></div><button id="addEvent" class="btn" style="margin-top:16px">+ Add Event</button></div></div>
      <div class="grid hidden" id="flashcards"><div class="card"><h3>Flashcards</h3><div class="small">Review your cards</div><div style="margin-top:16px" class="flashcards" id="flashcardList"></div><button id="addFlashcard" class="btn" style="margin-top:16px">+ Add Flashcard</button></div></div>
      <div class="grid hidden" id="grades"><div class="card"><h3>Grade Tracker</h3><div class="small">Track your courses and averages</div><div style="margin-top:16px" class="grades" id="gradeList"></div><button id="addSubject" class="btn" style="margin-top:16px">+ Add Subject</button></div></div>
      <div class="grid hidden" id="quicklinks"><div class="card"><h3>Quick Links</h3><div class="small">Your custom shortcuts</div><div style="margin-top:16px" class="links" id="quickLinksList"></div><button id="addLink" class="btn" style="margin-top:16px">+ Add Link</button></div></div>
      <div class="grid hidden" id="settings"><div class="card"><h3>Settings</h3><div class="small">Customize your workspace</div><form id="settingsForm" style="margin-top:16px" class="settings-form"><label>Name: <input type="text" id="setName" placeholder="Your Name"></label><label>Email: <input type="email" id="setEmail" placeholder="your@email.com"></label><label>Profile Picture: <input type="file" id="setAvatar" accept="image/*"></label><label>Accent Color: <input type="color" id="setAccent"></label><label>Background Color: <input type="color" id="setBg"></label><label>Default Theme: <select id="setTheme"><option value="light">Light</option><option value="oled">OLED Dark</option></select></label><div class="customize-section"><h4>Customize Sidebar</h4><div class="toggle"><label><input type="checkbox" data-nav="tasks">Tasks</label></div><div class="toggle"><label><input type="checkbox" data-nav="notes">Notes</label></div><div class="toggle"><label><input type="checkbox" data-nav="calendar">Calendar</label></div><div class="toggle"><label><input type="checkbox" data-nav="flashcards">Flashcards</label></div><div class="toggle"><label><input type="checkbox" data-nav="grades">Grades</label></div><div class="toggle"><label><input type="checkbox" data-nav="quicklinks">Quick Links</label></div></div><div class="customize-section"><h4>Customize Overview</h4><div class="toggle"><label><input type="checkbox" data-overview="overviewTasks">Tasks</label></div><div class="toggle"><label><input type="checkbox" data-overview="overviewNotifications">Notifications</label></div><div class="toggle"><label><input type="checkbox" data-overview="dailyQuote">Daily Quote</label></div></div><button type="submit" class="btn" style="margin-top:16px">Save Settings</button></form></div></div>
      <div class="footer"><div class="small"></div></div>
    </main>
  </div>
  <dialog id="addTaskModal"><h3>Add New Task</h3><form id="taskForm"><label>Title: <input type="text" id="taskTitle" required></label><label>Day: <input type="text" id="taskDay" placeholder="e.g., Thu" required></label><label>Category: <input type="text" id="taskCategory" placeholder="e.g., UI" required></label><label>Priority: <select id="taskPriority" required><option value="low">Low</option><option value="med">Med</option><option value="high">High</option></select></label><div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px"><button type="button" class="btn ghost" onclick="this.closest('dialog').close()">Cancel</button><button type="submit" class="btn">Add</button></div></form></dialog>
  <dialog id="addNoteModal"><h3>Add New Note</h3><form id="noteForm"><label>Title: <input type="text" id="noteTitle" required></label><label>Category: <input type="text" id="noteCategory" placeholder="e.g., Study Notes"></label><label>Content: <textarea id="noteContent" required></textarea></label><div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px"><button type="button" class="btn ghost" onclick="this.closest('dialog').close()">Cancel</button><button type="submit" class="btn">Add</button></div></form></dialog>
  <dialog id="addEventModal"><h3>Add Event</h3><form id="eventForm"><label>Date: <input type="date" id="eventDate" required></label><label>Description: <input type="text" id="eventDesc" required></label><div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px"><button type="button" class="btn ghost" onclick="this.closest('dialog').close()">Cancel</button><button type="submit" class="btn">Add</button></div></form></dialog>
  <dialog id="dayEventsModal"><h3>Events on <span id="modalDay"></span></h3><div id="dayEventsList" class="tasks"></div><div style="display:flex;gap:10px;justify-content:flex-end;margin-top:16px"><button type="button" class="btn ghost" onclick="this.closest('dialog').close()">Close</button></div></dialog>
  <dialog id="addFlashcardModal"><h3>Add Flashcard</h3><form id="flashcardForm"><label>Category: <input type="text" id="fcCategory" placeholder="e.g., Vocabulary"></label><label>Front: <input type="text" id="fcFront" required></label><label>Back: <input type="text" id="fcBack" required></label><div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px"><button type="button" class="btn ghost" onclick="this.closest('dialog').close()">Cancel</button><button type="submit" class="btn">Add</button></div></form></dialog>
  <dialog id="addSubjectModal"><h3>Add Subject</h3><form id="subjectForm"><label>Subject Name: <input type="text" id="subjectName" required></label><div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px"><button type="button" class="btn ghost" onclick="this.closest('dialog').close()">Cancel</button><button type="submit" class="btn">Add</button></div></form></dialog>
  <dialog id="addGradeModal"><h3>Add Grade to <span id="gradeSubject"></span></h3><form id="gradeForm"><label>Grade (%): <input type="number" id="gradeValue" min="0" max="100" step="0.01" required></label><label>Description: <input type="text" id="gradeDesc" placeholder="e.g., Midterm"></label><div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px"><button type="button" class="btn ghost" onclick="this.closest('dialog').close()">Cancel</button><button type="submit" class="btn">Add</button></div></form></dialog>
  <dialog id="addLinkModal"><h3>Add New Link</h3><form id="linkForm"><label>Title: <input type="text" id="linkTitle" required></label><label>URL: <input type="url" id="linkUrl" required></label><label>Icon (Emoji): <input type="text" id="linkIcon" placeholder="e.g., 📚"></label><div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px"><button type="button" class="btn ghost" onclick="this.closest('dialog').close()">Cancel</button><button type="submit" class="btn">Add</button></div></form></dialog>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DATA MANAGEMENT ---
    let appData = {};

    const defaultData = {
        settings: {
            name: 'Student',
            email: 'student@os.com',
            avatar: null,
            accentColor: '#2563eb',
            bgColor: '#f7f9fb',
            theme: 'light',
            nav: { tasks: true, notes: true, calendar: true, flashcards: true, grades: true, quicklinks: true },
            overview: { overviewTasks: true, overviewNotifications: true, dailyQuote: true }
        },
        currentTheme: 'light',
        tasks: [
            { id: 1, title: 'Sketch project wireframes', day: 'Thu', category: 'UI', priority: 'med' },
            { id: 2, title: 'Read ch.5 — Fourier', day: 'Sat', category: 'Math', priority: 'high' }
        ],
        notes: [
            { id: 1, title: 'History Essay', category: 'Reminders', content: 'The final draft is due tomorrow.'}
        ],
        events: [
            { id: 1, date: '2025-09-10', desc: 'Team Project Meeting' }
        ],
        flashcards: [
            { id: 1, category: 'Science', front: 'H₂O', back: 'Water' }
        ],
        grades: [
            { id: 1, subject: 'Mathematics', items: [ {id: 1, desc: 'Midterm', value: 90}, {id: 2, desc: 'Assignment 1', value: 70} ] }
        ],
        links: [
            { id: 1, title: 'University Portal', url: '#', icon: '🎓' }
        ],
        notifications: [
            { id: 1, content: 'Welcome to StudentOS! Customize your dashboard in the settings.'}
        ]
    };

    function saveData() {
        localStorage.setItem('studentOSData', JSON.stringify(appData));
    }

    function loadData() {
        const savedData = localStorage.getItem('studentOSData');
        appData = savedData ? JSON.parse(savedData) : JSON.parse(JSON.stringify(defaultData));
    }

    function getNextId(arr) {
        return arr.length > 0 ? Math.max(...arr.map(item => item.id)) + 1 : 1;
    }

    // --- RENDERING FUNCTIONS ---
    function renderAll() {
        renderSettings();
        applySettings();
        renderTasks();
        renderNotes();
        renderFlashcards();
        renderGrades();
        renderLinks();
        renderNotifications();
        updateCalendar();
    }
    
    function applySettings() {
        // Apply theme
        document.documentElement.classList.toggle('theme-oled', appData.currentTheme === 'oled');
        document.getElementById('themeToggle').textContent = appData.currentTheme === 'oled' ? 'Light Mode' : 'OLED Dark';
        
        // Apply colors
        document.documentElement.style.setProperty('--accent', appData.settings.accentColor);
        document.documentElement.style.setProperty('--bg', appData.settings.bgColor);

        // Update profile
        document.getElementById('userName').textContent = appData.settings.name;
        document.getElementById('headerTitle').textContent = `${appData.settings.name}'s Workspace`;
        document.getElementById('userEmail').textContent = appData.settings.email;
        const avatarEl = document.getElementById('userAvatar');
        if (appData.settings.avatar) {
            avatarEl.style.backgroundImage = `url(${appData.settings.avatar})`;
            avatarEl.textContent = '';
        } else {
            avatarEl.style.backgroundImage = '';
            avatarEl.textContent = appData.settings.name.charAt(0).toUpperCase();
        }

        // Sidebar visibility
        for (const navId in appData.settings.nav) {
            const button = document.querySelector(`.nav button[data-view="${navId}"]`);
            if (button) button.style.display = appData.settings.nav[navId] ? 'flex' : 'none';
        }
        // Overview visibility
        for (const overviewId in appData.settings.overview) {
            const card = document.getElementById(overviewId);
            if(card) card.style.display = appData.settings.overview[overviewId] ? 'block' : 'none';
        }
    }
    
    function renderSettings() {
        document.getElementById('setName').value = appData.settings.name;
        document.getElementById('setEmail').value = appData.settings.email;
        document.getElementById('setAccent').value = appData.settings.accentColor;
        document.getElementById('setBg').value = appData.settings.bgColor;
        document.getElementById('setTheme').value = appData.settings.theme;

        for (const navId in appData.settings.nav) {
            const checkbox = document.querySelector(`#settingsForm input[data-nav="${navId}"]`);
            if (checkbox) checkbox.checked = appData.settings.nav[navId];
        }
        for (const overviewId in appData.settings.overview) {
            const checkbox = document.querySelector(`#settingsForm input[data-overview="${overviewId}"]`);
            if(checkbox) checkbox.checked = appData.settings.overview[overviewId];
        }
    }

    function renderTasks() {
        const tasksList = document.getElementById('tasksList');
        const allTasksList = document.getElementById('allTasksList');
        tasksList.innerHTML = '';
        allTasksList.innerHTML = '';
        if (appData.tasks.length === 0) {
            const placeholder = '<div class="small">No tasks yet. Add one!</div>';
            tasksList.innerHTML = placeholder;
            allTasksList.innerHTML = placeholder;
        } else {
            appData.tasks.forEach(task => {
                const taskEl = `
                    <div class="task" data-id="${task.id}">
                        <div style="flex:1">
                            <div class="title">${task.title}</div>
                            <div class="meta">${task.day} • ${task.category}</div>
                        </div>
                        <span class="pill ${task.priority}">${task.priority.toUpperCase()}</span>
                        <span class="delete-btn" data-type="tasks">×</span>
                    </div>`;
                tasksList.innerHTML += taskEl;
                allTasksList.innerHTML += taskEl;
            });
        }
    }
    
    function renderNotes() {
        const notesList = document.getElementById('notesList');
        notesList.innerHTML = '';
        if (appData.notes.length === 0) {
            notesList.innerHTML = '<div class="small">No notes yet. Add one!</div>';
        } else {
            appData.notes.forEach(note => {
                notesList.innerHTML += `
                    <div class="note" data-id="${note.id}">
                        <div>
                            <div style="font-weight:600;font-size:16px">${note.title}</div>
                            <div style="font-size:13px;color:var(--muted);margin-bottom:6px">${note.category}</div>
                            <div>${note.content.replace(/\n/g, '<br>')}</div>
                        </div>
                        <span class="delete-btn" data-type="notes">×</span>
                    </div>`;
            });
        }
    }

    function renderFlashcards() {
        const list = document.getElementById('flashcardList');
        list.innerHTML = '';
        if (appData.flashcards.length === 0) {
            list.innerHTML = '<div class="small">No flashcards yet. Add one!</div>';
        } else {
            appData.flashcards.forEach(fc => {
                list.innerHTML += `
                    <div class="flashcard" data-id="${fc.id}">
                        <div class="flashcard-inner">
                            <div class="flashcard-category">${fc.category}</div>
                            <div class="flashcard-front">${fc.front}</div>
                            <div class="flashcard-back">${fc.back}</div>
                        </div>
                        <span class="delete-btn" style="position:absolute;top:10px;right:10px;z-index:3;" data-type="flashcards">×</span>
                    </div>`;
            });
        }
    }
    
    function renderGrades() {
        const list = document.getElementById('gradeList');
        list.innerHTML = '';
        if (appData.grades.length === 0) {
            list.innerHTML = '<div class="small">No subjects yet. Add one!</div>';
        } else {
            appData.grades.forEach(subject => {
                const total = subject.items.reduce((acc, item) => acc + item.value, 0);
                const avg = subject.items.length > 0 ? (total / subject.items.length).toFixed(2) : 0;
                let gradeItemsHTML = '';
                subject.items.forEach(item => {
                    const color = item.value >= 80 ? 'var(--good)' : item.value >= 60 ? 'var(--warning)' : 'var(--danger)';
                    gradeItemsHTML += `
                        <div class="grade-item" data-id="${item.id}">
                           <span class="grade-value">${item.desc}: ${item.value}% <span style="color:${color}">●</span></span>
                           <span class="delete-btn" data-type="grade-item" data-subject-id="${subject.id}">×</span>
                        </div>`;
                });

                list.innerHTML += `
                    <div class="grade" data-id="${subject.id}">
                        <div class="grade-header">
                            <span>${subject.subject} - Average: ${avg}%</span>
                            <span class="delete-btn" data-type="grades">×</span>
                        </div>
                        <div class="grade-progress"><div class="grade-progress-bar" style="width:${avg}%"></div></div>
                        <div class="grade-list">${gradeItemsHTML}</div>
                        <button class="btn ghost add-grade-btn" data-subject-id="${subject.id}" data-subject-name="${subject.subject}">+ Add Grade</button>
                    </div>`;
            });
        }
    }
    
    function renderLinks() {
        const list = document.getElementById('quickLinksList');
        list.innerHTML = '';
        if (appData.links.length === 0) {
            list.innerHTML = '<div class="small">No links yet. Add one!</div>';
        } else {
            appData.links.forEach(link => {
                list.innerHTML += `
                    <div class="link" data-id="${link.id}">
                        <div class="link-icon">${link.icon || '🔗'}</div>
                        <a href="${link.url}" target="_blank" rel="noopener noreferrer">${link.title}</a>
                        <span class="delete-btn" data-type="links">×</span>
                    </div>`;
            });
        }
    }
    
    function renderNotifications() {
        const list = document.getElementById('notificationsList');
        list.innerHTML = '';
        if (appData.notifications.length === 0) {
            list.innerHTML = '<div class="small">No notifications.</div>';
        } else {
            appData.notifications.slice().reverse().slice(0, 5).forEach(note => { // Show latest 5
                list.innerHTML += `<div class="note" data-id="${note.id}"><div>${note.content}</div><span class="delete-btn" data-type="notifications">×</span></div>`;
            });
        }
    }
    
    function addNotification(content, save = true) {
        const newNotif = { id: getNextId(appData.notifications), content };
        appData.notifications.push(newNotif);
        if (save) saveData();
        renderNotifications();
    }


    // --- CALENDAR ---
    let calendarDate = new Date();
    function updateCalendar() {
        const calendarGrid = document.getElementById('calendarGrid');
        document.getElementById('calendarMonth').textContent = `${calendarDate.toLocaleString('default', { month: 'long' })} ${calendarDate.getFullYear()}`;
        
        const year = calendarDate.getFullYear();
        const month = calendarDate.getMonth();
        const firstDay = (new Date(year, month, 1).getDay() + 6) % 7; // Monday is 0
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        calendarGrid.innerHTML = ['Mo','Tu','We','Th','Fr','Sa','Su'].map(d => `<div class="cal-header">${d}</div>`).join('');
        calendarGrid.innerHTML += Array(firstDay).fill('<div></div>').join('');

        for (let day = 1; day <= daysInMonth; day++) {
            const currentDate = new Date(year, month, day);
            const dateStr = currentDate.toISOString().split('T')[0];
            const hasEvent = appData.events.some(e => e.date === dateStr);
            const isToday = new Date().toDateString() === currentDate.toDateString();
            
            calendarGrid.innerHTML += `
                <div class="cal-day ${isToday ? 'cal-current' : ''}" data-date="${dateStr}">
                    ${day}
                    ${hasEvent ? '<div class="cal-event-dot"></div>' : ''}
                </div>`;
        }
    }

    document.getElementById('prevMonthBtn').addEventListener('click', () => {
        calendarDate.setMonth(calendarDate.getMonth() - 1);
        updateCalendar();
    });
    document.getElementById('nextMonthBtn').addEventListener('click', () => {
        calendarDate.setMonth(calendarDate.getMonth() + 1);
        updateCalendar();
    });
    
    document.getElementById('calendarGrid').addEventListener('click', (e) => {
        const dayEl = e.target.closest('.cal-day');
        if (!dayEl || !dayEl.dataset.date) return;

        const date = dayEl.dataset.date;
        const dayEvents = appData.events.filter(event => event.date === date);

        if (dayEvents.length > 0) {
            const modalDay = document.getElementById('modalDay');
            modalDay.textContent = new Date(date + 'T00:00:00').toLocaleDateString();
            const eventListEl = document.getElementById('dayEventsList');
            eventListEl.innerHTML = dayEvents.map(event => `
                <div class="task" data-id="${event.id}">
                    <div>${event.desc}</div>
                    <span class="delete-btn" data-type="events">×</span>
                </div>`
            ).join('');
            document.getElementById('dayEventsModal').showModal();
        }
    });

    // --- DAILY QUOTE ---
    async function fetchQuote() {
        try {
            const response = await fetch('https://api.quotable.io/random');
            const data = await response.json();
            document.getElementById('quoteText').textContent = `"${data.content}"`;
            document.getElementById('quoteAuthor').textContent = `— ${data.author}`;
        } catch (error) {
            console.error('Failed to fetch quote:', error);
            document.getElementById('quoteText').textContent = '"The journey of a thousand miles begins with a single step."';
            document.getElementById('quoteAuthor').textContent = '— Lao Tzu';
        }
    }

    // --- EVENT LISTENERS ---

    // Theme Toggle
    document.getElementById('themeToggle').addEventListener('click', () => {
        appData.currentTheme = appData.currentTheme === 'light' ? 'oled' : 'light';
        saveData();
        applySettings();
    });

    // Navigation
    document.getElementById('sidebarNav').addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            document.querySelectorAll('.nav button').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            const viewId = e.target.dataset.view;
            document.querySelectorAll('.grid').forEach(view => view.classList.toggle('hidden', view.id !== viewId));
        }
    });

    // --- Modal Openers ---
    document.getElementById('quickAdd').addEventListener('click', () => document.getElementById('addTaskModal').showModal());
    document.getElementById('addNote').addEventListener('click', () => document.getElementById('addNoteModal').showModal());
    document.getElementById('addEvent').addEventListener('click', () => document.getElementById('addEventModal').showModal());
    document.getElementById('addFlashcard').addEventListener('click', () => document.getElementById('addFlashcardModal').showModal());
    document.getElementById('addSubject').addEventListener('click', () => document.getElementById('addSubjectModal').showModal());
    document.getElementById('addLink').addEventListener('click', () => document.getElementById('addLinkModal').showModal());
    
    document.getElementById('gradeList').addEventListener('click', e => {
        if (e.target.classList.contains('add-grade-btn')) {
            const modal = document.getElementById('addGradeModal');
            modal.querySelector('#gradeSubject').textContent = e.target.dataset.subjectName;
            modal.dataset.subjectId = e.target.dataset.subjectId;
            modal.showModal();
        }
    });
    
    document.getElementById('flashcardList').addEventListener('click', e => {
        const card = e.target.closest('.flashcard');
        if (card && !e.target.classList.contains('delete-btn')) {
            card.classList.toggle('show-back');
        }
    });

    // --- Form Submissions ---
    document.getElementById('taskForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const newTask = {
            id: getNextId(appData.tasks),
            title: document.getElementById('taskTitle').value,
            day: document.getElementById('taskDay').value,
            category: document.getElementById('taskCategory').value,
            priority: document.getElementById('taskPriority').value,
        };
        appData.tasks.push(newTask);
        addNotification(`New task added: ${newTask.title}`);
        saveData();
        renderTasks();
        e.target.closest('dialog').close();
        e.target.reset();
    });

    document.getElementById('noteForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const newNote = {
            id: getNextId(appData.notes),
            title: document.getElementById('noteTitle').value,
            category: document.getElementById('noteCategory').value || 'Uncategorized',
            content: document.getElementById('noteContent').value,
        };
        appData.notes.push(newNote);
        addNotification(`New note added: ${newNote.title}`);
        saveData();
        renderNotes();
        e.target.closest('dialog').close();
        e.target.reset();
    });

    document.getElementById('eventForm').addEventListener('submit', e => {
        e.preventDefault();
        const newEvent = {
            id: getNextId(appData.events),
            date: document.getElementById('eventDate').value,
            desc: document.getElementById('eventDesc').value,
        };
        appData.events.push(newEvent);
        addNotification(`Event added for ${newEvent.date}: ${newEvent.desc}`);
        saveData();
        updateCalendar();
        e.target.closest('dialog').close();
        e.target.reset();
    });

    document.getElementById('flashcardForm').addEventListener('submit', e => {
        e.preventDefault();
        const newFc = {
            id: getNextId(appData.flashcards),
            category: document.getElementById('fcCategory').value || 'General',
            front: document.getElementById('fcFront').value,
            back: document.getElementById('fcBack').value,
        };
        appData.flashcards.push(newFc);
        saveData();
        renderFlashcards();
        e.target.closest('dialog').close();
        e.target.reset();
    });

    document.getElementById('subjectForm').addEventListener('submit', e => {
        e.preventDefault();
        const newSubject = {
            id: getNextId(appData.grades),
            subject: document.getElementById('subjectName').value,
            items: []
        };
        appData.grades.push(newSubject);
        saveData();
        renderGrades();
        e.target.closest('dialog').close();
        e.target.reset();
    });
    
    document.getElementById('gradeForm').addEventListener('submit', e => {
        e.preventDefault();
        const subjectId = parseInt(document.getElementById('addGradeModal').dataset.subjectId);
        const subject = appData.grades.find(s => s.id === subjectId);
        if (subject) {
            const newGrade = {
                id: getNextId(subject.items),
                desc: document.getElementById('gradeDesc').value || 'Grade',
                value: parseFloat(document.getElementById('gradeValue').value)
            };
            subject.items.push(newGrade);
            saveData();
            renderGrades();
        }
        e.target.closest('dialog').close();
        e.target.reset();
    });

    document.getElementById('linkForm').addEventListener('submit', e => {
        e.preventDefault();
        const newLink = {
            id: getNextId(appData.links),
            title: document.getElementById('linkTitle').value,
            url: document.getElementById('linkUrl').value,
            icon: document.getElementById('linkIcon').value,
        };
        appData.links.push(newLink);
        saveData();
        renderLinks();
        e.target.closest('dialog').close();
        e.target.reset();
    });
    
    document.getElementById('settingsForm').addEventListener('submit', (e) => {
        e.preventDefault();
        appData.settings.name = document.getElementById('setName').value;
        appData.settings.email = document.getElementById('setEmail').value;
        appData.settings.accentColor = document.getElementById('setAccent').value;
        appData.settings.bgColor = document.getElementById('setBg').value;
        appData.settings.theme = document.getElementById('setTheme').value;
        
        document.querySelectorAll('#settingsForm input[data-nav]').forEach(cb => {
            appData.settings.nav[cb.dataset.nav] = cb.checked;
        });
        document.querySelectorAll('#settingsForm input[data-overview]').forEach(cb => {
            appData.settings.overview[cb.dataset.overview] = cb.checked;
        });

        const avatarFile = document.getElementById('setAvatar').files[0];
        if (avatarFile) {
            const reader = new FileReader();
            reader.onload = (e) => {
                appData.settings.avatar = e.target.result;
                saveData();
                applySettings();
            };
            reader.readAsDataURL(avatarFile);
        } else {
            saveData();
            applySettings();
        }
        addNotification('Settings saved!', false); // Don't re-save
    });
    
    // --- Deletion Logic ---
    document.body.addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-btn')) {
            const btn = e.target;
            const type = btn.dataset.type;
            const itemEl = btn.closest('[data-id]');
            const id = parseInt(itemEl.dataset.id);

            if (!type || !itemEl || isNaN(id)) return;
            
            if (type === 'grade-item') {
                const subjectId = parseInt(btn.dataset.subjectId);
                const subject = appData.grades.find(s => s.id === subjectId);
                if(subject) subject.items = subject.items.filter(item => item.id !== id);
                renderGrades();
            } else {
                appData[type] = appData[type].filter(item => item.id !== id);
                // Dynamically call the correct render function based on type
                const renderFunc = {
                    tasks: renderTasks,
                    notes: renderNotes,
                    events: updateCalendar,
                    flashcards: renderFlashcards,
                    grades: renderGrades,
                    links: renderLinks,
                    notifications: renderNotifications
                }[type];
                
                if (renderFunc) renderFunc();
            }
            saveData();
        }
    });

    // --- INITIALIZATION ---
    function init() {
        loadData();
        renderAll();
        fetchQuote();
    }

    init();
});
</script>
</body>
</html>
